<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0a0c0e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="description" content="Sneak Preview Prognose mit Community-Voting f√ºr UCI Ruhr Park">
    
    <title>Sneak Prognose | Community Voting</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiU25lYWsgUHJvZ25vc2UiLCJzaG9ydF9uYW1lIjoiU25lYWsiLCJzdGFydF91cmwiOiIuIiwiZGlzcGxheSI6InN0YW5kYWxvbmUiLCJiYWNrZ3JvdW5kX2NvbG9yIjoiIzBhMGMwZSIsInRoZW1lX2NvbG9yIjoiIzBhMGMwZSIsImljb25zIjpbeyJzcmMiOiJodHRwczovL2Nkbi5nbG9iYWwuY29tL2ltYWdlcy9pY29ucy9mb290ZXJfZmF2aWNvbi5wbmciLCJzaXplcyI6IjE5MngxOTIiLCJ0eXBlIjoiaW1hZ2UvcG5nIn1dfQ==">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">
    
    <style>
        * { 
            -webkit-tap-highlight-color: transparent;
            font-family: 'Plus Jakarta Sans', sans-serif;
        }
        
        .font-display { font-family: 'Space Grotesk', sans-serif; }
        
        /* Aurora Background */
        .aurora {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: 
                radial-gradient(ellipse 80% 50% at 20% 40%, rgba(0, 224, 84, 0.12), transparent),
                radial-gradient(ellipse 60% 40% at 80% 60%, rgba(255, 128, 0, 0.08), transparent),
                radial-gradient(ellipse 50% 30% at 50% 100%, rgba(59, 130, 246, 0.08), transparent),
                linear-gradient(180deg, #0a0c0e 0%, #14181c 100%);
        }
        
        /* Glass Cards */
        .glass-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.06) 0%, rgba(255,255,255,0.02) 100%);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 
                0 4px 6px -1px rgba(0, 0, 0, 0.3),
                0 2px 4px -1px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }
        
        /* Voting Bar Animation */
        .vote-bar {
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Selected Option */
        .vote-option {
            transition: all 0.2s ease;
        }
        
        .vote-option:hover {
            transform: translateX(4px);
        }
        
        .vote-option.selected {
            border-color: rgba(0, 224, 84, 0.5);
            background: rgba(0, 224, 84, 0.1);
        }
        
        /* Trend Indicators */
        .trend-up { color: #00e054; }
        .trend-down { color: #ef4444; }
        .trend-stable { color: #9ca3af; }
        
        /* Countdown */
        .countdown-digit {
            font-variant-numeric: tabular-nums;
        }
        
        /* Pulse Animation for Live */
        .live-indicator {
            animation: pulse-live 2s infinite;
        }
        
        @keyframes pulse-live {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Confetti */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            pointer-events: none;
            animation: confetti-fall 3s ease-out forwards;
        }
        
        @keyframes confetti-fall {
            0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        
        /* Toast */
        .toast {
            animation: toast-in 0.3s ease-out, toast-out 0.3s ease-in 2.7s forwards;
        }
        
        @keyframes toast-in {
            from { transform: translateY(100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes toast-out {
            to { transform: translateY(100px); opacity: 0; }
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: rgba(255,255,255,0.02); border-radius: 3px; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.2); }
        
        /* Winner Animation */
        .winner-glow {
            animation: winner-pulse 2s ease-in-out infinite;
        }
        
        @keyframes winner-pulse {
            0%, 100% { box-shadow: 0 0 20px rgba(0, 224, 84, 0.3); }
            50% { box-shadow: 0 0 40px rgba(0, 224, 84, 0.6); }
        }
        
        [x-cloak] { display: none !important; }
    </style>
</head>
<body class="text-white antialiased overflow-x-hidden" x-data="sneakApp()" x-init="init()">
    
    <!-- Aurora Background -->
    <div class="aurora"></div>
    
    <!-- Toast Notification -->
    <div x-show="toast.show" x-cloak x-transition class="fixed bottom-24 left-1/2 -translate-x-1/2 z-50 glass-card px-6 py-3 rounded-full flex items-center gap-2">
        <span x-show="toast.type === 'success'" class="text-emerald-400">‚úì</span>
        <span x-show="toast.type === 'error'" class="text-red-400">‚úó</span>
        <span x-text="toast.message" class="text-sm font-medium"></span>
    </div>
    
    <div class="min-h-screen px-4 py-6 pb-24 max-w-7xl mx-auto">
        
        <!-- Header -->
        <header class="mb-8">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 rounded-2xl bg-gradient-to-br from-emerald-400 to-emerald-600 flex items-center justify-center shadow-lg shadow-emerald-500/20">
                        <svg class="w-7 h-7 text-black" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M18 3v2h-2V3H8v2H6V3H4v18h2v-2h2v2h8v-2h2v2h2V3h-2zM8 17H6v-2h2v2zm0-4H6v-2h2v2zm0-4H6V7h2v2zm10 8h-2v-2h2v2zm0-4h-2v-2h2v2zm0-4h-2V7h2v2z"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="font-display text-2xl font-bold tracking-tight">Sneak<span class="text-emerald-400">Prognose</span></h1>
                        <p class="text-xs text-slate-400 font-medium flex items-center gap-1">
                            UCI Ruhr Park
                            <span class="w-1 h-1 rounded-full bg-emerald-500"></span>
                            <span class="live-indicator text-emerald-400 flex items-center gap-1">
                                <span class="w-1.5 h-1.5 rounded-full bg-emerald-400"></span>
                                Live Voting
                            </span>
                        </p>
                    </div>
                </div>
                
                <div class="flex items-center gap-2">
                    <button @click="showStats = true" class="w-10 h-10 rounded-xl glass-card flex items-center justify-center text-slate-300 hover:text-white transition-colors" title="Statistiken">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                        </svg>
                    </button>
                    <button @click="adminModal = true" class="w-10 h-10 rounded-xl glass-card flex items-center justify-center text-slate-300 hover:text-white transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                        </svg>
                    </button>
                </div>
            </div>
        </header>
        
        <!-- Countdown Banner -->
        <div class="glass-card rounded-2xl p-4 mb-6" x-show="!sneakRevealed">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-xl bg-orange-500/20 flex items-center justify-center">
                        <svg class="w-5 h-5 text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </div>
                    <div>
                        <p class="text-xs text-slate-400">N√§chste Sneak beginnt in</p>
                        <p class="font-display text-xl font-bold countdown-digit">
                            <span x-text="countdown.days"></span>d 
                            <span x-text="countdown.hours"></span>h 
                            <span x-text="countdown.minutes"></span>m
                        </p>
                    </div>
                </div>
                <div class="text-right">
                    <p class="text-xs text-slate-400">Bereits abgestimmt</p>
                    <p class="font-display text-2xl font-bold text-emerald-400" x-text="totalVotes"></p>
                </div>
            </div>
        </div>
        
        <!-- Winner Revealed Banner -->
        <div x-show="sneakRevealed" x-cloak class="glass-card rounded-2xl p-6 mb-6 winner-glow border-2 border-emerald-500/30">
            <div class="text-center">
                <p class="text-sm text-emerald-400 font-semibold mb-2">üéâ DIE SNEAK WAR:</p>
                <h2 class="font-display text-3xl font-bold mb-2" x-text="revealedMovie.title"></h2>
                <p class="text-slate-400 text-sm" x-text="revealedMovie.meta"></p>
                <div class="mt-4 flex justify-center gap-2">
                    <span class="px-3 py-1 rounded-full bg-emerald-500/20 text-emerald-400 text-xs">
                        <span x-text="correctVoters"></span> hatten recht!
                    </span>
                    <span class="px-3 py-1 rounded-full bg-white/10 text-slate-300 text-xs">
                        Trefferquote: <span x-text="accuracyRate"></span>%
                    </span>
                </div>
            </div>
        </div>
        
        <!-- Main Content Grid -->
        <div class="grid lg:grid-cols-2 gap-6">
            
            <!-- LEFT: Current Movie & Review -->
            <div class="space-y-6">
                <!-- Last Sneak -->
                <div class="glass-card rounded-3xl overflow-hidden">
                    <div class="p-5">
                        <div class="flex items-center gap-2 mb-4">
                            <span class="px-3 py-1 rounded-full bg-emerald-500 text-black text-xs font-bold uppercase">
                                Zuletzt: <span x-text="lastSneakDate"></span>
                            </span>
                        </div>
                        
                        <div class="flex gap-4">
                            <img :src="tmdbBase + appData.hero.poster" 
                                 @error="$event.target.src = 'https://via.placeholder.com/150x225/1c2228/9ab?text=?'"
                                 class="w-32 rounded-xl shadow-lg"
                                 :alt="appData.hero.title">
                            <div class="flex-1">
                                <h3 class="font-display text-xl font-bold mb-1" x-text="appData.hero.title"></h3>
                                <p class="text-sm text-slate-400 mb-3" x-text="appData.hero.meta"></p>
                                
                                <!-- Rating -->
                                <div class="flex gap-1 mb-3">
                                    <template x-for="i in 5">
                                        <button @click="setRating(i)" 
                                                class="text-xl transition-transform hover:scale-110"
                                                :class="i <= (userRatings[appData.hero.id]?.rating || 0) ? 'text-emerald-400' : 'text-slate-600'">
                                            ‚òÖ
                                        </button>
                                    </template>
                                </div>
                                
                                <textarea x-model="currentComment" 
                                          @blur="saveReview()"
                                          placeholder="Dein Fazit..."
                                          class="w-full bg-black/30 border border-white/10 rounded-lg px-3 py-2 text-sm resize-none"
                                          rows="2"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Next Prediction Info -->
                <div class="glass-card rounded-3xl p-5">
                    <div class="flex items-center gap-2 mb-4">
                        <span class="px-3 py-1 rounded-full bg-orange-500/20 text-orange-400 text-xs font-bold uppercase border border-orange-500/30">
                            Admin Prognose
                        </span>
                    </div>
                    
                    <div class="flex gap-4">
                        <img :src="tmdbBase + appData.prediction.poster" 
                             @error="$event.target.src = 'https://via.placeholder.com/150x225/1c2228/9ab?text=?'"
                             class="w-28 rounded-xl shadow-lg"
                             :alt="appData.prediction.title">
                        <div class="flex-1">
                            <h3 class="font-display text-lg font-bold mb-1" x-text="appData.prediction.title"></h3>
                            <p class="text-sm text-slate-400 mb-3" x-text="appData.prediction.meta"></p>
                            
                            <div class="glass rounded-lg p-3">
                                <div class="flex justify-between text-sm mb-1">
                                    <span class="text-slate-400">Wahrscheinlichkeit</span>
                                    <span class="font-bold text-orange-400" x-text="appData.prediction.prob + '%'"></span>
                                </div>
                                <div class="h-2 bg-white/10 rounded-full overflow-hidden">
                                    <div class="h-full bg-gradient-to-r from-orange-500 to-amber-400 rounded-full transition-all"
                                         :style="'width: ' + appData.prediction.prob + '%'"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- RIGHT: Community Voting -->
            <div class="glass-card rounded-3xl p-5" x-show="!sneakRevealed">
                <div class="flex items-center justify-between mb-5">
                    <div>
                        <h3 class="font-display text-lg font-bold flex items-center gap-2">
                            <svg class="w-5 h-5 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                            </svg>
                            Community Voting
                        </h3>
                        <p class="text-xs text-slate-400 mt-1">Was tippt die Community?</p>
                    </div>
                    <button @click="showVotingInfo = true" class="text-slate-400 hover:text-white">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </button>
                </div>
                
                <!-- User Already Voted Notice -->
                <div x-show="userVote" class="mb-4 p-3 rounded-xl bg-emerald-500/10 border border-emerald-500/30 flex items-center gap-3">
                    <span class="text-2xl">‚úì</span>
                    <div>
                        <p class="text-sm font-medium text-emerald-400">Du hast abgestimmt!</p>
                        <p class="text-xs text-slate-400">Dein Tipp: <span x-text="userVote"></span></p>
                    </div>
                    <button @click="changeVote()" class="ml-auto text-xs text-slate-400 hover:text-white underline">√Ñndern</button>
                </div>
                
                <!-- Voting Options -->
                <div class="space-y-3" x-show="!userVote || changingVote">
                    <template x-for="(option, index) in votingOptions" :key="index">
                        <div @click="!userVote && vote(option.title)" 
                             class="vote-option relative p-4 rounded-xl border border-white/10 cursor-pointer"
                             :class="{ 
                                 'selected': userVote === option.title,
                                 'opacity-50 cursor-not-allowed': userVote && userVote !== option.title
                             }">
                            <div class="flex items-center gap-3">
                                <img :src="tmdbBase + option.poster" 
                                     @error="$event.target.src = 'https://via.placeholder.com/50x75/1c2228/9ab?text=?'"
                                     class="w-12 h-18 rounded-lg object-cover shadow-md">
                                <div class="flex-1 min-w-0">
                                    <h4 class="font-semibold truncate" x-text="option.title"></h4>
                                    <p class="text-xs text-slate-400" x-text="option.meta"></p>
                                </div>
                                <div x-show="userVote" class="text-right">
                                    <p class="font-display text-xl font-bold" x-text="getVotePercentage(option.title) + '%'"></p>
                                    <p class="text-xs text-slate-500" x-text="getVoteCount(option.title) + ' Stimmen'"></p>
                                </div>
                            </div>
                            
                            <!-- Progress Bar -->
                            <div x-show="userVote" class="mt-3 h-2 bg-white/10 rounded-full overflow-hidden">
                                <div class="vote-bar h-full rounded-full"
                                     :class="index === 0 ? 'bg-emerald-500' : index === 1 ? 'bg-blue-500' : index === 2 ? 'bg-purple-500' : 'bg-slate-500'"
                                     :style="'width: ' + getVotePercentage(option.title) + '%'"></div>
                            </div>
                            
                            <!-- Winner Badge -->
                            <div x-show="isTopVoted(option.title) && userVote" 
                                 class="absolute -top-2 -right-2 w-6 h-6 rounded-full bg-emerald-500 text-black flex items-center justify-center text-xs font-bold shadow-lg">
                                1
                            </div>
                        </div>
                    </template>
                </div>
                
                <!-- Results Display (after voting) -->
                <div x-show="userVote && !changingVote" class="mt-4 space-y-2">
                    <div class="flex items-center justify-between text-sm">
                        <span class="text-slate-400">Top 3 Tipps:</span>
                        <span class="text-xs text-slate-500" x-text="'Stand: ' + new Date().toLocaleTimeString('de-DE', {hour: '2-digit', minute: '2-digit'}) + ' Uhr'"></span>
                    </div>
                    
                    <template x-for="(result, index) in sortedResults" :key="index">
                        <div class="flex items-center gap-3 p-2 rounded-lg bg-white/5">
                            <span class="w-6 text-center font-display font-bold" 
                                  :class="index === 0 ? 'text-emerald-400' : index === 1 ? 'text-blue-400' : 'text-slate-400'"
                                  x-text="index + 1"></span>
                            <span class="flex-1 text-sm truncate" x-text="result.title"></span>
                            <span class="font-bold" x-text="result.percentage + '%'"></span>
                            <span x-show="result.trend === 'up'" class="trend-up text-xs">‚ñ≤</span>
                            <span x-show="result.trend === 'down'" class="trend-down text-xs">‚ñº</span>
                        </div>
                    </template>
                </div>
            </div>
            
            <!-- Results After Reveal -->
            <div x-show="sneakRevealed" x-cloak class="glass-card rounded-3xl p-5">
                <h3 class="font-display text-lg font-bold mb-4">Auswertung</h3>
                <p class="text-sm text-slate-400 mb-4">Wie gut war die Community?</p>
                
                <div class="space-y-3">
                    <template x-for="(result, index) in finalResults" :key="index">
                        <div class="flex items-center gap-3 p-3 rounded-xl"
                             :class="result.isWinner ? 'bg-emerald-500/20 border border-emerald-500/30' : 'bg-white/5'">
                            <span x-show="result.isWinner" class="text-xl">üèÜ</span>
                            <span x-show="!result.isWinner" class="w-6 text-center text-slate-500" x-text="index + 1"></span>
                            <span class="flex-1 font-medium" x-text="result.title"></span>
                            <div class="text-right">
                                <p class="font-bold" x-text="result.percentage + '%'"></p>
                                <p class="text-xs text-slate-500" x-text="result.votes + ' Stimmen'"></p>
                            </div>
                        </div>
                    </template>
                </div>
                
                <button @click="startNewRound()" class="mt-4 w-full py-3 rounded-xl bg-emerald-500 hover:bg-emerald-400 text-black font-semibold transition-colors">
                    Neue Runde starten
                </button>
            </div>
        </div>
        
        <!-- Stats Modal -->
        <div x-show="showStats" x-cloak class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm" x-transition.opacity>
            <div @click.away="showStats = false" class="glass-card rounded-3xl w-full max-w-md max-h-[90vh] overflow-y-auto" x-transition.scale>
                <div class="p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="font-display text-xl font-bold">Deine Statistik</h2>
                        <button @click="showStats = false" class="text-slate-400 hover:text-white">‚úï</button>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div class="glass rounded-2xl p-4 text-center">
                            <p class="text-3xl font-bold text-emerald-400" x-text="userStats.totalVotes"></p>
                            <p class="text-xs text-slate-400">Abstimmungen</p>
                        </div>
                        <div class="glass rounded-2xl p-4 text-center">
                            <p class="text-3xl font-bold text-emerald-400" x-text="userStats.correctPredictions"></p>
                            <p class="text-xs text-slate-400">Richtige Tipps</p>
                        </div>
                        <div class="glass rounded-2xl p-4 text-center">
                            <p class="text-3xl font-bold text-blue-400" x-text="userStats.accuracy + '%'"></p>
                            <p class="text-xs text-slate-400">Trefferquote</p>
                        </div>
                        <div class="glass rounded-2xl p-4 text-center">
                            <p class="text-3xl font-bold text-orange-400" x-text="userStats.currentStreak + 'üî•'"></p>
                            <p class="text-xs text-slate-400">Aktuelle Serie</p>
                        </div>
                    </div>
                    
                    <h3 class="font-semibold mb-3">Historie</h3>
                    <div class="space-y-2 max-h-60 overflow-y-auto">
                        <template x-for="(entry, index) in userStats.history" :key="index">
                            <div class="flex items-center gap-3 p-3 rounded-xl bg-white/5">
                                <span x-text="entry.correct ? '‚úì' : '‚úó'" 
                                      :class="entry.correct ? 'text-emerald-400' : 'text-red-400'"></span>
                                <div class="flex-1">
                                    <p class="text-sm font-medium" x-text="entry.predicted"></p>
                                    <p class="text-xs text-slate-500" x-text="entry.date"></p>
                                </div>
                                <span x-show="entry.correct" class="text-xs text-emerald-400">Richtig!</span>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Admin Modal -->
        <div x-show="adminModal" x-cloak class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm" x-transition.opacity>
            <div @click.away="adminModal = false" class="glass-card rounded-3xl w-full max-w-lg" x-transition.scale>
                <!-- Login -->
                <div x-show="!adminLoggedIn" class="p-6">
                    <h2 class="font-display text-xl font-bold mb-4">Admin</h2>
                    <input type="password" x-model="adminPass" @keyup.enter="checkLogin()" placeholder="Passwort" class="w-full bg-black/30 border border-white/10 rounded-xl px-4 py-3 mb-4 focus:border-emerald-500/50 focus:outline-none">
                    <div class="flex gap-3">
                        <button @click="adminModal = false" class="flex-1 py-3 rounded-xl bg-white/5 text-slate-300">Abbrechen</button>
                        <button @click="checkLogin()" class="flex-1 py-3 rounded-xl bg-emerald-500 text-black font-semibold">Login</button>
                    </div>
                </div>
                
                <!-- Admin Panel -->
                <div x-show="adminLoggedIn" x-cloak class="p-6">
                    <h2 class="font-display text-xl font-bold mb-4">Sneak verwalten</h2>
                    
                    <!-- Reveal Winner -->
                    <div class="glass rounded-2xl p-4 border border-emerald-500/20 mb-4">
                        <h3 class="text-sm font-bold text-emerald-400 mb-3">Sneak aufl√∂sen</h3>
                        <select x-model="revealWinnerTitle" class="w-full bg-black/30 border border-white/10 rounded-lg px-3 py-2 mb-3 text-sm">
                            <option value="">Welcher Film war es?</option>
                            <template x-for="option in votingOptions">
                                <option :value="option.title" x-text="option.title"></option>
                            </template>
                        </select>
                        <button @click="revealSneak()" class="w-full py-2 rounded-lg bg-emerald-500 text-black font-semibold text-sm">Aufl√∂sen & Neue Runde</button>
                    </div>
                    
                    <!-- Edit Options -->
                    <div class="glass rounded-2xl p-4 mb-4">
                        <h3 class="text-sm font-bold text-blue-400 mb-3">Voting-Optionen</h3>
                        <div class="space-y-2 max-h-48 overflow-y-auto">
                            <template x-for="(option, index) in editVotingOptions" :key="index">
                                <div class="flex gap-2">
                                    <input type="text" x-model="option.title" placeholder="Filmtitel" class="flex-1 bg-black/30 border border-white/10 rounded-lg px-3 py-2 text-sm">
                                    <input type="text" x-model="option.poster" placeholder="TMDB Path" class="flex-1 bg-black/30 border border-white/10 rounded-lg px-3 py-2 text-sm">
                                </div>
                            </template>
                        </div>
                        <button @click="addVotingOption()" class="mt-2 text-sm text-emerald-400 hover:text-emerald-300">+ Option hinzuf√ºgen</button>
                    </div>
                    
                    <!-- Edit Prediction -->
                    <div class="glass rounded-2xl p-4 mb-4">
                        <h3 class="text-sm font-bold text-orange-400 mb-3">Admin Prognose</h3>
                        <input type="text" x-model="editData.prediction.title" placeholder="Titel" class="w-full bg-black/30 border border-white/10 rounded-lg px-3 py-2 text-sm mb-2">
                        <input type="text" x-model="editData.prediction.poster" placeholder="Poster Path" class="w-full bg-black/30 border border-white/10 rounded-lg px-3 py-2 text-sm mb-2">
                        <input type="number" x-model="editData.prediction.prob" min="0" max="100" placeholder="%" class="w-full bg-black/30 border border-white/10 rounded-lg px-3 py-2 text-sm">
                    </div>
                    
                    <div class="flex gap-3">
                        <button @click="adminModal = false" class="flex-1 py-3 rounded-xl bg-white/5 text-slate-300">Schlie√üen</button>
                        <button @click="saveAdminChanges()" class="flex-1 py-3 rounded-xl bg-emerald-500 text-black font-semibold">Speichern</button>
                    </div>
                </div>
            </div>
        </div>
        
    </div>
    
    <script>
        function sneakApp() {
            return {
                tmdbBase: 'https://image.tmdb.org/t/p/w500',
                
                // App Data
                defaultData: {
                    hero: {
                        title: 'No Other Choice',
                        poster: '/tImzXp37Q2RBcIdYS1HRdtffEaD.jpg',
                        meta: '2026 ¬∑ Thriller ¬∑ Action',
                        id: 'sneak_kw06_26'
                    },
                    prediction: {
                        title: 'Cold Storage',
                        poster: '/wPBjoPOLlbr2BvZFmUUWYdwmF4o.jpg',
                        meta: '2026 ¬∑ Horror ¬∑ Sci-Fi',
                        prob: 92,
                        id: 'sneak_kw07_26'
                    },
                    history: []
                },
                appData: {},
                userRatings: {},
                currentComment: '',
                
                // Voting
                defaultVotingOptions: [
                    { title: 'Cold Storage', poster: '/wPBjoPOLlbr2BvZFmUUWYdwmF4o.jpg', meta: '2026 ¬∑ Horror ¬∑ Sci-Fi' },
                    { title: 'The Brutalist', poster: '/5TPP7b.jpg', meta: '2026 ¬∑ Drama' },
                    { title: 'Mickey 17', poster: '/hIITm.jpg', meta: '2026 ¬∑ Sci-Fi ¬∑ Action' },
                    { title: 'A Working Man', poster: '/3ktdE.jpg', meta: '2026 ¬∑ Action ¬∑ Thriller' }
                ],
                votingOptions: [],
                votes: {},
                userVote: null,
                changingVote: false,
                totalVotes: 0,
                
                // Reveal
                sneakRevealed: false,
                revealedMovie: {},
                revealWinnerTitle: '',
                
                // Countdown
                countdown: { days: 0, hours: 0, minutes: 0 },
                lastSneakDate: 'KW06',
                nextSneakDate: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000), // 5 days from now
                
                // UI
                adminModal: false,
                adminLoggedIn: false,
                adminPass: '',
                showStats: false,
                showVotingInfo: false,
                toast: { show: false, message: '', type: 'success' },
                
                // Edit
                editData: {},
                editVotingOptions: [],
                
                // User Stats
                userStats: {
                    totalVotes: 0,
                    correctPredictions: 0,
                    accuracy: 0,
                    currentStreak: 0,
                    history: []
                },
                
                init() {
                    // Load data
                    this.appData = JSON.parse(localStorage.getItem('sneak_data')) || this.defaultData;
                    this.votingOptions = JSON.parse(localStorage.getItem('sneak_voting_options')) || this.defaultVotingOptions;
                    this.votes = JSON.parse(localStorage.getItem('sneak_votes')) || {};
                    this.userVote = localStorage.getItem('sneak_user_vote');
                    this.userRatings = JSON.parse(localStorage.getItem('sneak_user_ratings')) || {};
                    this.currentComment = this.userRatings[this.appData.hero.id]?.comment || '';
                    this.userStats = JSON.parse(localStorage.getItem('sneak_user_stats')) || this.userStats;
                    this.sneakRevealed = localStorage.getItem('sneak_revealed') === 'true';
                    this.revealedMovie = JSON.parse(localStorage.getItem('sneak_revealed_movie')) || {};
                    
                    this.editData = JSON.parse(JSON.stringify(this.appData));
                    this.editVotingOptions = JSON.parse(JSON.stringify(this.votingOptions));
                    
                    this.calculateTotalVotes();
                    this.startCountdown();
                    
                    // Simulate some initial votes for demo
                    if (Object.keys(this.votes).length === 0) {
                        this.simulateInitialVotes();
                    }
                },
                
                simulateInitialVotes() {
                    // Add some demo votes
                    const demoVotes = {
                        'Cold Storage': 12,
                        'The Brutalist': 8,
                        'Mickey 17': 5,
                        'A Working Man': 3
                    };
                    this.votes = demoVotes;
                    this.calculateTotalVotes();
                    localStorage.setItem('sneak_votes', JSON.stringify(this.votes));
                },
                
                calculateTotalVotes() {
                    this.totalVotes = Object.values(this.votes).reduce((a, b) => a + b, 0);
                },
                
                getVoteCount(title) {
                    return this.votes[title] || 0;
                },
                
                getVotePercentage(title) {
                    if (this.totalVotes === 0) return 0;
                    return Math.round((this.getVoteCount(title) / this.totalVotes) * 100);
                },
                
                get sortedResults() {
                    return this.votingOptions
                        .map(opt => ({
                            title: opt.title,
                            votes: this.getVoteCount(opt.title),
                            percentage: this.getVotePercentage(opt.title),
                            trend: Math.random() > 0.5 ? 'up' : 'stable' // Simulated trend
                        }))
                        .sort((a, b) => b.votes - a.votes)
                        .slice(0, 3);
                },
                
                get finalResults() {
                    return this.votingOptions
                        .map(opt => ({
                            title: opt.title,
                            votes: this.getVoteCount(opt.title),
                            percentage: this.getVotePercentage(opt.title),
                            isWinner: opt.title === this.revealedMovie.title
                        }))
                        .sort((a, b) => b.votes - a.votes);
                },
                
                get correctVoters() {
                    return this.getVoteCount(this.revealedMovie.title);
                },
                
                get accuracyRate() {
                    if (this.totalVotes === 0) return 0;
                    return Math.round((this.correctVoters / this.totalVotes) * 100);
                },
                
                isTopVoted(title) {
                    const sorted = this.sortedResults;
                    return sorted.length > 0 && sorted[0].title === title;
                },
                
                vote(title) {
                    if (this.userVote) return;
                    
                    // Add vote
                    this.votes[title] = (this.votes[title] || 0) + 1;
                    this.userVote = title;
                    this.calculateTotalVotes();
                    
                    // Save
                    localStorage.setItem('sneak_votes', JSON.stringify(this.votes));
                    localStorage.setItem('sneak_user_vote', title);
                    
                    // Update stats
                    this.userStats.totalVotes++;
                    localStorage.setItem('sneak_user_stats', JSON.stringify(this.userStats));
                    
                    // Show confetti
                    this.showConfetti(event);
                    this.showToast('Dein Tipp wurde gespeichert!', 'success');
                },
                
                changeVote() {
                    if (this.userVote) {
                        this.votes[this.userVote]--;
                        if (this.votes[this.userVote] <= 0) delete this.votes[this.userVote];
                        this.userVote = null;
                        this.changingVote = true;
                        this.calculateTotalVotes();
                        localStorage.setItem('sneak_votes', JSON.stringify(this.votes));
                        localStorage.removeItem('sneak_user_vote');
                    }
                },
                
                revealSneak() {
                    if (!this.revealWinnerTitle) return;
                    
                    const winner = this.votingOptions.find(o => o.title === this.revealWinnerTitle);
                    if (!winner) return;
                    
                    this.revealedMovie = winner;
                    this.sneakRevealed = true;
                    
                    // Check if user was correct
                    const wasCorrect = this.userVote === this.revealWinnerTitle;
                    
                    // Update user stats
                    if (this.userVote) {
                        this.userStats.history.unshift({
                            date: new Date().toLocaleDateString('de-DE'),
                            predicted: this.userVote,
                            actual: this.revealWinnerTitle,
                            correct: wasCorrect
                        });
                        
                        if (wasCorrect) {
                            this.userStats.correctPredictions++;
                            this.userStats.currentStreak++;
                        } else {
                            this.userStats.currentStreak = 0;
                        }
                        
                        this.userStats.accuracy = Math.round(
                            (this.userStats.correctPredictions / this.userStats.totalVotes) * 100
                        );
                        
                        localStorage.setItem('sneak_user_stats', JSON.stringify(this.userStats));
                    }
                    
                    // Save reveal state
                    localStorage.setItem('sneak_revealed', 'true');
                    localStorage.setItem('sneak_revealed_movie', JSON.stringify(winner));
                    
                    this.showToast('Sneak aufgel√∂st!', 'success');
                },
                
                startNewRound() {
                    // Move current prediction to hero
                    this.appData.hero = { ...this.revealedMovie };
                    
                    // Reset voting
                    this.sneakRevealed = false;
                    this.userVote = null;
                    this.votes = {};
                    this.changingVote = false;
                    this.calculateTotalVotes();
                    
                    // Save
                    localStorage.setItem('sneak_data', JSON.stringify(this.appData));
                    localStorage.setItem('sneak_votes', JSON.stringify({}));
                    localStorage.setItem('sneak_revealed', 'false');
                    localStorage.removeItem('sneak_user_vote');
                    localStorage.removeItem('sneak_revealed_movie');
                    
                    // Simulate new votes
                    setTimeout(() => this.simulateInitialVotes(), 100);
                    
                    this.showToast('Neue Runde gestartet!', 'success');
                },
                
                startCountdown() {
                    setInterval(() => {
                        const now = new Date();
                        const diff = this.nextSneakDate - now;
                        
                        if (diff <= 0) {
                            this.countdown = { days: 0, hours: 0, minutes: 0 };
                            return;
                        }
                        
                        this.countdown = {
                            days: Math.floor(diff / (1000 * 60 * 60 * 24)),
                            hours: Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)),
                            minutes: Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60))
                        };
                    }, 60000); // Update every minute
                    
                    // Initial calculation
                    const now = new Date();
                    const diff = this.nextSneakDate - now;
                    this.countdown = {
                        days: Math.floor(diff / (1000 * 60 * 60 * 24)),
                        hours: Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)),
                        minutes: Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60))
                    };
                },
                
                setRating(rating) {
                    if (!this.userRatings[this.appData.hero.id]) {
                        this.userRatings[this.appData.hero.id] = {};
                    }
                    this.userRatings[this.appData.hero.id].rating = rating;
                    localStorage.setItem('sneak_user_ratings', JSON.stringify(this.userRatings));
                    this.showToast('Bewertung gespeichert!', 'success');
                },
                
                saveReview() {
                    if (!this.userRatings[this.appData.hero.id]) {
                        this.userRatings[this.appData.hero.id] = {};
                    }
                    this.userRatings[this.appData.hero.id].comment = this.currentComment;
                    localStorage.setItem('sneak_user_ratings', JSON.stringify(this.userRatings));
                },
                
                checkLogin() {
                    if (this.adminPass === 'Lesterw45') {
                        this.adminLoggedIn = true;
                        this.adminPass = '';
                        this.editVotingOptions = JSON.parse(JSON.stringify(this.votingOptions));
                    } else {
                        this.showToast('Falsches Passwort', 'error');
                    }
                },
                
                addVotingOption() {
                    this.editVotingOptions.push({ title: '', poster: '', meta: '' });
                },
                
                saveAdminChanges() {
                    this.votingOptions = this.editVotingOptions.filter(o => o.title.trim() !== '');
                    this.appData.prediction = this.editData.prediction;
                    
                    localStorage.setItem('sneak_voting_options', JSON.stringify(this.votingOptions));
                    localStorage.setItem('sneak_data', JSON.stringify(this.appData));
                    
                    this.adminModal = false;
                    this.adminLoggedIn = false;
                    this.showToast('√Ñnderungen gespeichert!', 'success');
                },
                
                showToast(message, type) {
                    this.toast = { show: true, message, type };
                    setTimeout(() => this.toast.show = false, 3000);
                },
                
                showConfetti(e) {
                    const colors = ['#00e054', '#ff8000', '#3b82f6', '#fbbf24'];
                    for (let i = 0; i < 20; i++) {
                        const confetti = document.createElement('div');
                        confetti.className = 'confetti';
                        confetti.style.left = (e.clientX + (Math.random() - 0.5) * 100) + 'px';
                        confetti.style.top = e.clientY + 'px';
                        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                        document.body.appendChild(confetti);
                        setTimeout(() => confetti.remove(), 3000);
                    }
                }
            }
        }
    </script>
</body>
</html>
